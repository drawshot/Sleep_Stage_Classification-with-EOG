## Sleep Stage Classification with EOG
EOG 신호를 이용한 머신러닝 기반의 수면 단계 분류

### 프로젝트 기간
2018-08-01 ~ 2019-04-30

### 프로젝트 설명
수면은 인간의 일상에 많은 비중을 차지하고 있다. 수면은 무의식 상태를 유지하며, 신체 및 정신에 휴식을 제공하여 건강을 회복, 유지 시켜주는 과정을 말한다.
수면은 크게 렘수면(rapid eye movement : REM), 비렘수면(non-rapid eye movement : non-REM)으로 구분할 수 있으며, 비렘수면은 수면의 깊이에 따라서 다시 S1(1단계), S2(2단계), S3(3단계), S4(4단계)로 구분할 수 있다.
프로젝트의 목표는 흔히 EEG, EMG 채널을 이용한 수면 단계 분류가 아닌 안전위도(electrooculogram : EOG) 신호를 이용해 수면 단계를 분류하여 수면다원검사를 대체할 수 있는 머신러닝 알고리즘 개발을 목표로 한다.
수면 단계를 분류하기 위하여 합성곱 신경망(Convolution Neural Networks : CNN) 알고리즘을 이용하여 학습 및 테스트를 하였으며, 이에 사용된 모델은 Inception-v3 모델을 사용하였다.
<br />
<br />
1. 수면 단계 <br />
수면은 무의식을 유지하는 상태를 말하며, 신체 및 정신에 휴식을 제공하여 건강을 회복, 유지 시켜주는 과정을 말한다.
이러한 수면의 상태를 판단하는 방법으로 수면 상태에서 관찰되는 일정한 뇌파를 주로 사용하여 구분한다. 뇌파란 사람의 두피 상의 두 점 사이의 전위 변동을 연속적으로 기록한 신호를 말한다.
<img width="456" alt="스크린샷 2019-10-05 오후 3 46 54" src="https://user-images.githubusercontent.com/26424846/66251115-60ac0c00-e787-11e9-8add-c3207b9f4c4c.png">
<br />
위 그림은 수먼 단계(Sleep Stage)를 그래프로 나타낸 것으로, 주로 뇌파로 구분이 되는 수면 단계는 크게 REM수면과 비REM수면 단계로 구분이 된다. 인간의 수면은 보통 비REM수면으로 시작해서 점점 깊은 잠에 빠져들게 되며 잠들고 나서 80~100분 만에 첫 번째 REM수면이 나타난다. 그 후로 비REM수면과 REM수면이 약 90분을 주기로 하루 밤에 4~6회 정도 반복된다.
<br />
<br />
2. EEG 신호 <br />
수면 단계를 분류하기 위한 신호로 EEG 신호가 가장 많이 사용되는데, EEG 신호란 대뇌피질의 신경 세포군에서 발생한 뇌 전기활동의 총화(Summation)를 체외로 도출하고 이를 증폭해서 전위를 종축으로, 시간을 횡축으로 하여 두피 상의 두 점 사이의 전위 변동을 연속적으로 기록한 신호를 말한다. EEG 신호를 측정하기 위해서는 작은 전극들을 두피에 부착하여 측정이 가능하며, 전극의 부착 부위는 보통 국제적으로 통일되어 있는 10-20 전극 배치법(10-20 System)을 사용한다. 10-20 전극 배치법은 가장 널리 사용되는 뇌파 전극 부착 방법으로 각각의 전극 부착 위치에 따라 전두부(Frontal), 중심부(Central), 두정부(Parietal), 측두부(Temporal), 후두부(Occipital)을 의미하는 등 전극 부착 위치에 따라 다른 신호들을 측정할 수 있다.
<img width="350" alt="스크린샷 2019-10-05 오후 3 54 35" src="https://user-images.githubusercontent.com/26424846/66251197-7a018800-e788-11e9-9daf-e212ad66b02b.png">
<br />
3. EOG 신호 <br />
EEG 신호 다음으로 수면 단계 분류에 많이 활용되는 신호로는 EOG 신호가 있다. EOG 신호란 눈의 앞과 뒤에 존재하는 망막 전위를 측정하는 기술로 안구 운동을 기록한 것을 말한다. 아래 그림은 EOG 신호를 기록하기 위한 전극의 부착 위치를 나타내는 것이다. 안구 운동을 기록하기 위해서는 보통 한 쌍의 전극을 눈 위쪽과 아래쪽 또는 눈 왼쪽과 오른쪽에 부착을 하고, 안구가 두 전극 중 하나를 향해 움직이게 되는 경우 바라보는 방향의 전극은 망막의 양성 부분을 확인하고 반대쪽에 있는 전극은 망막의 음성 부분을 확인하게 된다. 이로 인해 결국 전극 사이에 전위차가 발생하고 이를 기록하면 EOG 신호가 된다. 
<img width="400" alt="스크린샷 2019-10-05 오후 3 58 07" src="https://user-images.githubusercontent.com/26424846/66251230-f2684900-e788-11e9-9561-90d4c78c3935.png">
<br />
4. EMG 신호 <br />
EEG 신호와 EOG 신호 외에 EMG 신호도 수면 단계 분류에 많이 활용된다. EMG는 근육의 전기 활동을 증폭 시키고 기록하는 것으로 근육의 전기 활동을 활용하기 때문에 전극의 부착 부위에 따라 다양한 EMG 신호를 기록할 수 있다.

<br />
수면 단계 분류 알고리즘의 전체적인 흐름
* EDF 데이터를 EEG, EOG, EMG 채널별로 분리(wav 파일로 저장)
* 판독 주기에 따라 30초 단위의 윈도우로 분리
* 분리된 데이터를 스펙트로그램 이미지로 변환 후 저장
* Inception-v3 모델을 이용하여 학습 및 테스트
<img width="237" alt="스크린샷 2019-09-26 오후 3 23 23" src="https://user-images.githubusercontent.com/26424846/65943912-870e3680-e46b-11e9-9808-5c0df504030e.png">


```python

```
